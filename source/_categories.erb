<% categories = [] %>
<% Dir.glob("./source#{current_page.url}*").select {|f| File.directory? f }.each do |category| %>

	<% sub_category_dir = File.basename(category) %>

	<% articles = [] %>
	<% Dir.glob("#{category}/*.md").each do |article| %>
		<% article_filename = File.basename(article, '.md') %>
		<% File.open article do |f| %>
			<% articles << YAML.load(f.read).merge({ "href" => "#{current_page.url}#{sub_category_dir}/#{article_filename}" }) %>
		<% end %>
	<% end %>

	<% categories << { :articles => articles, :sub_category_dir => sub_category_dir } %>

<% end %>


<ul class="library-categories">
	<% categories.each do |category| %>
		<li class="library-category">
			<h4 class="library-category-title"><%= category[:articles].first["category"] || category[:sub_category_dir].capitalize %></h4>
			<ul>
				<% category[:articles].each do |article| %>
					<li><a href="<%= article["href"] %>"><%= article["title"] %></a></li>
				<% end %>
			</ul>
		</li>
	<% end %>
</ul>
