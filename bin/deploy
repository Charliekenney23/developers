#!/usr/bin/env bash

help_text () {
  echo
  echo "Usage: deploy VERSION"
  echo
}

# check for required version to deploy
if [ -z ${1+x} ]; then
  help_text
  echo "Error: VERSION is required"
  exit 1
fi

# if we have made it this far, we are ready to make changes
echo "Deploying version ${1}"

echo "Checking out development branch"
git checkout development
echo "Creating a release branch release-${1}"
git checkout -b "release-${1}"
echo "Updating openapi.yaml with the new version number"
sed -ie -E -- "s|version: [0-9]+\.[0-9]+\.[0-9]|version: ${1}|" openapi.yaml
echo "Committing the version bump"
git add --all
git commit -m "Bump version to ${1}"
echo "Tagging the version commit with the version number"
git tag ${1}
